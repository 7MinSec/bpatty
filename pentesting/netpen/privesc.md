#Privilege Escalation
Some good blogs, cheat sheets, etc. for privesc.

#Linux
* g0tmi1k's [Basic Linux Privilege Escalation](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/) post should be in your bookmarks, like, right now.

* 1N3's [privesc project](https://github.com/1N3/PrivEsc) has "A collection of Windows, Linux and MySQL privilege escalation scripts and exploits."  Also check out [Kernel Exploits](https://www.kernel-exploits.com) for pre-compiled local Linux Exploits.

#Windows
##Quick wins
Here are several checks to do on a local system which may aid in privesc:

###Missing patches
Here are a few KBs to keep an eye out for.  If they're missing from the target you're pentesting, then privesc may be possible!

* https://support.microsoft.com/en-us/kb/3165191 (MS16-077) may allow potato/tater attack
* Many others - see [PowerShellEmpireModule_MissingPatches](https://github.com/hackern0v1c3/PowershellEmpireModule_MissingPatches)

###Check for LLMNR
See if EnableMulticast variable is present and not set to 0:

####Server 2008
    get-itemproperty -path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient"

####Server 2012

    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Services\Dnscache\Parameters"

###Check for NBT-NS
Find instances where Netbios name resolution is enabled (TRUE)

    wmic nicconfig where TcpipNetbiosOptions=0

P.S. - the fix is:

    wmic nicconfig where (TcpipNetBiosOptions!=Null and TcpipNetbiosOptions!=2) call SetTcpipNetbios 2

###Check for WPAD

Check *Internet Explorer > Internet Options > Connections Tab > LAN Settings > Auto Detect Enabled*

###See if plaintext credentials stored
Check if wdigest is in use:

    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\Security Packages"

Note: if `Security Packages` has a null value it won't auto-complete, so you can run the command at `\Lsa` to double-check.

###See if plaintext storage is enabled (`UseLogonCredential` not equal to 0):

    (UseLogonCredential != 0):
    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest"

###Check for DLL pre-loading
See if `CWDIllegalInDllSearch` exists and is not set to 0:

    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager"

### Check for SMB Signing
Check server (`requiresecuritysignature` is not equal to *1*)    

    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters"

Check the client (`requiresecuritysignature` not set to 1)

    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Services\LanManWorkstation\Parameters"
        
###Check for LM/NTLM hashing
Check if `lmcompatibilitylevel` does not equal `4,5:`

    get-itemproperty -path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa"   

###Check for Kerberos DES Hashing
Lookup supportedencryptiontypes (hex values differ):

    get-itemproperty -path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters"

Note `supportedencryptiontypes` does not exist (path is invalid in Server 2012)

##Hot Potato attack
This [attack](https://foxglovesecurity.com/2016/01/16/hot-potato/) "takes advantage of known issues in Windows to gain local privilege escalation in default configurations, namely NTLM relay (specifically HTTP->SMB relay) and NBNS spoofing" and can (potentially) work on Windows 7,8,10, Server 2008, and Server 2012.

##Rotten Potato attack
Read more [here](https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/), but per the site, the idea is:

1. Trick the “NT AUTHORITY\SYSTEM” account into authenticating via NTLM to a TCP endpoint we control.

2. Man-in-the-middle this authentication attempt (NTLM relay) to locally negotiate a security token for the “NT AUTHORITY\SYSTEM” account. This is done through a series of Windows API calls.

3. Impersonate the token we have just negotiated. This can only be done if the attackers current account has the privilege to impersonate security tokens. This is usually true of most service accounts and not true of most user-level accounts. 

##Just Enough Administration (JEA)
Here's a [great discussion](https://www.scriptjunkie.us/2016/10/just-too-much-administration-breaking-jea-powershells-new-security-barrier/) on using/abusing JEA, which is "a new Windows 10/Server 2016 feature to create granular least privilege policies by granting specific administrative privileges to users."  However, according to the article's author, "... every JEA role capability example I found Microsoft had published had vulnerabilities that could be exploited to obtain complete system administrative rights, most of them immediately, reliably, and without requiring any special configuration."

##Password brute-forcing / dumping
[Mimikittenz](https://github.com/putterpanda/mimikittenz)

[Better default passwordlist](https://github.com/govolution/betterdefaultpasslist)

[IPMI default pw list](https://github.com/netbiosX/Default-Credentials/blob/master/IPMI-Default-Password-List.mdown
)

##Tutorials
* A tutorial from [Fuzzy Security](http://www.fuzzysecurity.com/tutorials/16.html)
* Pentest Monkey's [windows-privesc-check](http://pentestmonkey.net/tools/windows-privesc-check) script